name: Release WPT

on:
  workflow_dispatch:
    inputs:
      ref:
        description: 'Commit or branch name to fetch'
        default: main

permissions:
  contents: write

env:
  RELEASE_NAME: wpt-${{ inputs.ref }}
jobs:
  create-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout WPT
        uses: actions/checkout@v4
        with:
          repository: 'web-platform-tests/wpt'
          ref: ${{ inputs.ref }}
      - name: Create Github Release
        shell: bash
        run: |
          gh release create $RELEASE_NAME || true
          git archive --prefix=$RELEASE_NAME -o $RELEASE_NAME.tar.gz ${{ inputs.ref }}
          gh release upload $RELEASE_NAME $RELEASE_NAME.tar.gz
